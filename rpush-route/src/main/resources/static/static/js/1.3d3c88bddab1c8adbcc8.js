webpackJsonp([1],{En30:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),n=a.n(s),r=a("Dd8w"),i=a.n(r),c=a("BO1k"),l=a.n(c),o=a("Xxa5"),d=a.n(o),u=a("exGp"),m=a.n(u),p=a("S+hO"),v=a("zL8q"),f={name:"groupManagement",components:{hisDetailDialog:function(){return a.e(14).then(a.bind(null,"6vVM"))},multiObjInput:function(){return a.e(10).then(a.bind(null,"ZMxm"))}},data:function(){return{keyword:"",menuListActive:{},menuList:[],configs:[],groups:[],inputReceiverId:"",addReceiverIds:[],sendMessageParam:{configIds:[],param:{}},selectedMessageType:null,selectedMessageTypeFields:[],showHisDetailDialog:!1,requestNo:"",messageTypes:[],schemeList:[],selectedScheme:null,dialogManageSchemeVisible:!1}},watch:{selectedMessageType:function(e){e&&"0"!==e&&this.changeMessageType()}},mounted:function(){var e=this;return m()(d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.platformList();case 2:case"end":return t.stop()}},t,e)}))()},methods:{multiObjChange:function(e,t){this.sendMessageParam.param[t]=e,this.$forceUpdate()},closeHisDetail:function(){this.showHisDetailDialog=!1},handleAddReceiverId:function(e){var t=new RegExp(this.menuListActive.validateReg).test(this.inputReceiverId);t||v.Message.error("格式校验不正确"),this.sendMessageParam.param[e.key]=this.sendMessageParam.param[e.key]||[],!this.inputReceiverId||this.sendMessageParam.param[e.key].indexOf(this.inputReceiverId)>=0||!t||(this.sendMessageParam.param[e.key].push(this.inputReceiverId),this.inputReceiverId="")},handleClearAddReceiverId:function(e){this.sendMessageParam.param[e.key]=[],this.$forceUpdate()},handleAddReceiverIdClose:function(e,t){this.sendMessageParam.param[e.key]=this.sendMessageParam.param[e.key]||[],this.sendMessageParam.param[e.key].splice(this.sendMessageParam.param[e.key].indexOf(t),1),this.$forceUpdate()},routeTo:function(e){var t=this;return m()(d.a.mark(function a(){var s,n,r,i,c,o,u;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e){a.next=22;break}for(s=!0,n=!1,r=void 0,a.prev=4,i=l()(t.menuList);!(s=(c=i.next()).done);s=!0)(o=c.value).id===e&&(t.menuListActive=o);a.next=12;break;case 8:a.prev=8,a.t0=a.catch(4),n=!0,r=a.t0;case 12:a.prev=12,a.prev=13,!s&&i.return&&i.return();case 15:if(a.prev=15,!n){a.next=18;break}throw r;case 18:return a.finish(15);case 19:return a.finish(12);case 20:a.next=23;break;case 22:t.menuListActive=t.menuList[0];case 23:return a.next=25,t.queryConfig();case 25:return a.next=27,t.queryGroup();case 27:return a.next=29,t.initParam();case 29:return a.next=31,Object(p.j)(t.menuListActive.id);case 31:return u=a.sent,t.messageTypes=u.data,t.selectedMessageType=t.messageTypes[0].id,a.next=36,t.changeMessageType();case 36:case"end":return a.stop()}},a,t,[[4,8,12,20],[13,,15,19]])}))()},refreshScheme:function(e){var t=this;Object(p.l)(this.selectedMessageType,function(a){t.schemeList=a.data,e&&e()})},platformList:function(){var e=this;return m()(d.a.mark(function t(){var a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(p.n)({keyword:e.keyword,pageNo:1,pageSize:999});case 2:0===(a=t.sent).code&&(e.menuList=a.data,e.routeTo(e.menuListActive.id||e.$route.query.platform));case 4:case"end":return t.stop()}},t,e)}))()},queryConfig:function(){var e=this;return m()(d.a.mark(function t(){var a,s;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(p.o)(e.menuListActive.id,{pageSize:2147483647});case 2:for(a=t.sent,e.configs=a.data.pagination.dataList,e.sendMessageParam.configIds=[],s=0;s<e.configs.length;s++)e.configs[s].defaultFlag&&e.sendMessageParam.configIds.push(e.configs[s].configId);case 6:case"end":return t.stop()}},t,e)}))()},queryGroup:function(){var e=this;return m()(d.a.mark(function t(){var a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(p.q)(e.menuListActive.id,{pageSize:2147483647});case 2:a=t.sent,e.groups=a.data.dataList;case 4:case"end":return t.stop()}},t,e)}))()},sendMessage:function(){var e=this;return m()(d.a.mark(function t(){var a,s,n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sendMessageParam.configIds.length){t.next=3;break}return v.Message.error("请选择至少一个配置"),t.abrupt("return");case 3:return(a={})[e.selectedMessageType]=i()({},e.sendMessageParam),t.next=7,Object(p.u)({messageParam:a});case 7:s=t.sent,n=e,r=e.$createElement,e.$msgbox({title:"结果",message:r("p",null,[r("span",null,"消息投递成功，请求号："+s.data)]),showCancelButton:!0,confirmButtonText:"查看日志",cancelButtonText:"知道了",beforeClose:function(t,a,r){"confirm"===t&&(n.requestNo=s.data,e.showHisDetailDialog=!0),r()}}).then(function(e){});case 11:case"end":return t.stop()}},t,e)}))()},doShowHisDetailDialog:function(){this.requestNo="",this.showHisDetailDialog=!0},initParam:function(){this.sendMessageParam.param={},this.inputReceiverId="",this.addReceiverIds=[]},changeMessageType:function(){var e=this;return m()(d.a.mark(function t(){var a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(p.k)(e.selectedMessageType);case 2:a=t.sent,e.selectedMessageTypeFields=a.data,e.selectedScheme=null,e.refreshScheme(),e.initParam();case 7:case"end":return t.stop()}},t,e)}))()},schemeChange:function(e){var t=this;return m()(d.a.mark(function a(){var s,n;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=3;break}return t.initParam(),a.abrupt("return");case 3:return a.next=5,Object(p.t)(e.id);case 5:s=a.sent,(n=s.data.param)&&(t.sendMessageParam=JSON.parse(n));case 8:case"end":return a.stop()}},a,t)}))()},deleteScheme:function(e){var t=this;return m()(d.a.mark(function a(){return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=3,Object(p.d)(e);case 3:t.selectedScheme&&e===t.selectedScheme.id&&(t.selectedScheme=null),t.refreshScheme();case 5:case"end":return a.stop()}},a,t)}))()},saveOrUpdateScheme:function(e){var t=this;return m()(d.a.mark(function a(){var s;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("manageScheme"!==e){a.next=3;break}return t.dialogManageSchemeVisible=!0,a.abrupt("return");case 3:s=t,t.$prompt("请输入方案名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:"saveOther"!==e&&t.selectedScheme?t.selectedScheme.name:null}).then(function(a){var r=a.value;Object(p.y)({id:"saveOther"!==e&&t.selectedScheme?s.selectedScheme.id:null,name:r,messageType:s.selectedMessageType,param:n()(s.sendMessageParam)},function(e){s.refreshScheme(function(){s.selectedScheme=e.data})})}).catch(function(){});case 5:case"end":return a.stop()}},a,t)}))()}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"taskManagement"},[a("div",{staticClass:"taskManagement_header"},[a("div",{staticClass:"title"},[a("el-row",[a("el-col",{attrs:{span:22}},[e._v("发消息")]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{type:"text"},on:{click:e.doShowHisDetailDialog}},[e._v("查看消息日志")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"taskManagement_container"},[a("div",{staticClass:"tm_c_wrap"},[a("div",{staticClass:"tm_c_menu"},[a("div",{staticClass:"tm_c_menu_option"},[e._m(0),e._v(" "),a("div",{staticClass:"tm_c_menu_search"},[a("el-input",{attrs:{size:"mini",placeholder:"请输入平台名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.platformList(t)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[a("el-button",{attrs:{slot:"append",size:"mini",icon:"el-icon-search"},on:{click:e.platformList},slot:"append"})],1)],1)]),e._v(" "),a("div",{staticClass:"tm_c_menu_list"},e._l(e.menuList,function(t,s){return a("div",{key:s,staticClass:"item",class:e.menuListActive.id===t.id?"itemActive":"",on:{click:function(a){return e.routeTo(t.id)}}},[a("div",[e._v(e._s(t.name))])])}),0)]),e._v(" "),a("div",{staticClass:"tm_c_table"},[a("div",{staticClass:"setOfLayer"},[a("div",[a("el-row",[a("el-col",{staticStyle:{padding:"12px 0"},attrs:{span:16}},[a("span",{staticStyle:{"font-size":"16px"}},[e._v(e._s(e.menuListActive.name))])]),e._v(" "),a("el-col",{staticStyle:{"padding-top":"4px"},attrs:{span:8}},[a("el-dropdown",{on:{command:e.saveOrUpdateScheme}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-setting el-icon--left"}),e._v("方案管理"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"saveOther"}},[e._v("另存为新方案")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"saveCurrent"}},[e._v("保存当前方案")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"manageScheme"}},[e._v("管理方案")])],1),e._v(" "),a("el-dialog",{attrs:{title:"管理方案",visible:e.dialogManageSchemeVisible},on:{"update:visible":function(t){e.dialogManageSchemeVisible=t}}},[a("el-table",{attrs:{data:e.schemeList}},[a("el-table-column",{attrs:{property:"name",label:"方案名称",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"确定要删除这个方案吗？"},on:{onConfirm:function(a){return e.deleteScheme(t.row.id)}}},[a("el-button",{attrs:{slot:"reference",type:"danger",size:"small"},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1)],1),e._v(" "),a("el-select",{attrs:{size:"small",clearable:"",placeholder:"请选择方案...","value-key":"id"},on:{change:e.schemeChange},model:{value:e.selectedScheme,callback:function(t){e.selectedScheme=t},expression:"selectedScheme"}},e._l(e.schemeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e}})}),1)],1)],1)],1),e._v(" "),a("div",{staticClass:"remarks_box"},[e._v("\n            "+e._s(e.menuListActive.description)+"\n          ")]),e._v(" "),a("div",{staticClass:"table_layout fixedLayer"},[a("div",{staticClass:"setOfLayer send-param"},[a("el-row",{staticStyle:{"border-bottom":"0","padding-bottom":"0"}},[a("el-col",{attrs:{span:24}},[a("el-tabs",{model:{value:e.selectedMessageType,callback:function(t){e.selectedMessageType=t},expression:"selectedMessageType"}},e._l(e.messageTypes,function(e){return a("el-tab-pane",{key:e.id,attrs:{label:e.name,name:e.id}})}),1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[e._v("\n                  选择配置：\n                  "),a("el-select",{attrs:{multiple:"",placeholder:"请选择配置..."},model:{value:e.sendMessageParam.configIds,callback:function(t){e.$set(e.sendMessageParam,"configIds",t)},expression:"sendMessageParam.configIds"}},e._l(e.configs,function(e){return a("el-option",{key:e.configId,attrs:{label:e.configName,value:e.configId}})}),1)],1)],1),e._v(" "),e._l(e.selectedMessageTypeFields,function(t){return a("div",["MULTI_OBJ_INPUT"===t.type?a("el-row",[a("el-col",{attrs:{span:24}},[a("multiObjInput",{attrs:{headers:t.multiObjFields,title:t.name},on:{change:function(a){return e.multiObjChange(a,t.key)}},model:{value:e.sendMessageParam.param[t.key],callback:function(a){e.$set(e.sendMessageParam.param,t.key,a)},expression:"sendMessageParam.param[item.key]"}})],1)],1):e._e(),e._v(" "),"RECEIVER_GROUP"===t.type?a("el-row",[a("el-col",{attrs:{span:24}},[e._v("\n                    选择分组：\n                    "),a("el-select",{attrs:{multiple:"",placeholder:"请选择分组..."},model:{value:e.sendMessageParam.param[t.key],callback:function(a){e.$set(e.sendMessageParam.param,t.key,a)},expression:"sendMessageParam.param[item.key]"}},e._l(e.groups,function(e){return a("el-option",{key:e.id,attrs:{label:e.groupName,value:e.id}})}),1)],1)],1):e._e(),e._v(" "),"BOOLEAN"===t.type?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-checkbox",{model:{value:e.sendMessageParam.param[t.key],callback:function(a){e.$set(e.sendMessageParam.param,t.key,a)},expression:"sendMessageParam.param[item.key]"}},[e._v(e._s(t.description||t.name))])],1)],1):e._e(),e._v(" "),"SELECT"===t.type?a("el-row",[a("el-col",{attrs:{span:24}},[e._v("\n                    "+e._s(t.name)+"：\n                    "),a("el-select",{attrs:{size:"small",placeholder:"请选择..."},model:{value:e.sendMessageParam.param[t.key],callback:function(a){e.$set(e.sendMessageParam.param,t.key,a)},expression:"sendMessageParam.param[item.key]"}},e._l(t.options,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1):e._e(),e._v(" "),"RECEIVER"===t.type?a("el-row",[a("el-col",{attrs:{span:6}},[a("el-input",{ref:"inputReceiverId",refInFor:!0,attrs:{size:"small",clearable:"",placeholder:"输入并回车补充接收人..."},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleAddReceiverId(t)}},model:{value:e.inputReceiverId,callback:function(t){e.inputReceiverId=t},expression:"inputReceiverId"}})],1),e._v(" "),a("el-col",{attrs:{span:15}},[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClearAddReceiverId(t)}}},[e._v("清空")]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(e.sendMessageParam.param[t.key]))])],1),e._v(" "),a("el-col",{attrs:{span:24}},e._l(e.sendMessageParam.param[t.key],function(s){return a("el-tag",{key:s,staticStyle:{"margin-bottom":"2px","margin-left":"2px"},attrs:{size:"small",closable:"",type:"info"},on:{close:function(a){return e.handleAddReceiverIdClose(t,s)}}},[e._v("\n                      "+e._s(s)+"\n                    ")])}),1)],1):e._e(),e._v(" "),"STRING"===t.type?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{size:"small",type:"text",clearable:"",placeholder:t.description||t.name},model:{value:e.sendMessageParam.param[t.key],callback:function(a){e.$set(e.sendMessageParam.param,t.key,a)},expression:"sendMessageParam.param[item.key]"}})],1)],1):e._e(),e._v(" "),"TEXTAREA"===t.type?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{type:"textarea",clearable:"",autosize:{minRows:15,maxRows:100},placeholder:t.description||t.name},model:{value:e.sendMessageParam.param[t.key],callback:function(a){e.$set(e.sendMessageParam.param,t.key,a)},expression:"sendMessageParam.param[item.key]"}})],1)],1):e._e()],1)}),e._v(" "),a("el-row",{staticStyle:{"border-bottom":"0","border-top":"1px solid #c3c6cc",position:"sticky",bottom:"0",background:"white"}},[a("el-col",{attrs:{span:24}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.sendMessage}},[e._v("发送")])],1)],1)],2)])])])])]),e._v(" "),a("hisDetailDialog",{attrs:{dialogVisible:e.showHisDetailDialog,requestNo:e.requestNo,platform:e.menuListActive.id},on:{closed:e.closeHisDetail}})],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tm_c_menu_top"},[t("div",{staticClass:"tm_c_menu_top_title"},[this._v("平台")])])}]};var g=a("VU/8")(f,h,!1,function(e){a("udDy"),a("JbOT")},"data-v-d28beb9e",null);t.default=g.exports},JbOT:function(e,t){},mvHQ:function(e,t,a){e.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(e,t,a){var s=a("FeBl"),n=s.JSON||(s.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},udDy:function(e,t){}});
//# sourceMappingURL=1.3d3c88bddab1c8adbcc8.js.map